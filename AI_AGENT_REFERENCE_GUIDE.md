# AI Agent Reference Guide for Komodo DeFi Framework Documentation

## Overview

This guide explains the automated documentation system used in the komodo-docs-mdx repository, specifically designed for AI agents creating documentation for KDF (Komodo DeFi Framework) API methods.

## Critical Concepts

### 1. Auto-Generated Files (DO NOT MANUALLY EDIT OR COMMIT)

These files are automatically generated by scripts and should NEVER be manually edited or committed:

- `src/pages/komodo-defi-framework/api/index.mdx` - The main API methods table
- `filepathSlugs.json` - Contains anchor slugs for all documentation files

### 2. File Structure and Naming Conventions

#### API Version Directories
- `src/pages/komodo-defi-framework/api/legacy/` - Legacy RPC methods
- `src/pages/komodo-defi-framework/api/v20/` - Version 2.0 stable methods  
- `src/pages/komodo-defi-framework/api/v20-dev/` - Version 2.0 development methods

#### Method Path Conversion
KDF methods use a specific naming convention:
- **Canonical form**: `task::enable_utxo::init` (uses `::` separators)
- **File/folder name**: `task-enable_utxo-init` (replace `::` with `-`, preserve `_`)

### 3. Documentation File Requirements

Every KDF method documentation file MUST contain:

#### Required Elements for Script Parsing

1. **Method Label in Heading**:
   ```mdx
   ## method_name {{label : 'method_name', tag : 'API-v2'}}
   ```

2. **CodeGroup with label attribute**:
   ```mdx
   <CodeGroup title="Method Name" tag="POST" label="method_name" mm2MethodDecorate="true">
   ```

3. **File Structure**:
   ```
   method_directory/
   ‚îî‚îÄ‚îÄ index.mdx
   ```

#### Document Structure Template

```mdx
export const title = "Komodo DeFi Framework Method: Method Name";
export const description = "Description of what this method does.";

# method_name

## method_name {{label : 'method_name', tag : 'API-v2'}}

Description of the method functionality.

### Arguments

| Structure | Type | Description |
|-----------|------|-------------|
| param1 | string | Parameter description |

### Response

| Structure | Type | Description |
|-----------|------|-------------|
| result | object | Response description |

### üìå Examples

<CodeGroup title="Method Name" tag="POST" label="method_name" mm2MethodDecorate="true">
  ```json
  {
    "userpass": "RPC_UserP@SSW0RD",
    "method": "method_name",
    "params": {}
  }
  ```
</CodeGroup>
```

### 4. Build Process Flow

When documentation is created, this sequence occurs:

1. **Documentation files created** by AI agent in appropriate directories
2. **`utils/gen_api_methods_table.py`** runs and:
   - Scans all KDF documentation files
   - Extracts method names from `label` attributes
   - Generates anchor slugs from headings and content
   - Updates `filepathSlugs.json` with new entries
   - Regenerates `src/pages/komodo-defi-framework/api/index.mdx`
3. **Navigation files updated** (sidebar.json) manually by AI agent
4. **Tests validate** the structure

### 5. Slug Generation Rules

Slugs are auto-generated from:
- Main method heading (becomes primary slug)
- Section headings (arguments, response, examples, etc.)
- Collapsible section titles
- Error response headings

Slug transformation:
- Convert to lowercase
- Replace spaces and underscores with hyphens
- Remove special characters except hyphens
- Example: "Response (success)" ‚Üí "response-success"

### 6. Navigation Integration

#### Sidebar Updates
Manual updates required in `src/data/sidebar.json`:
```json
{
  "title": "method_name",
  "href": "/komodo-defi-framework/api/legacy/method_name/"
}
```

#### Changelog Updates
Add new methods to `src/pages/komodo-defi-framework/changelog/index.mdx`.

## AI Agent Instructions

### DO
1. ‚úÖ Create properly structured documentation files
2. ‚úÖ Use correct label attributes in headings and CodeGroups
3. ‚úÖ Follow the directory structure conventions
4. ‚úÖ Update sidebar.json manually
5. ‚úÖ Update changelog manually
6. ‚úÖ Let the build process generate slugs and API index

### DON'T
1. ‚ùå Edit `src/pages/komodo-defi-framework/api/index.mdx` manually
2. ‚ùå Edit `filepathSlugs.json` manually
3. ‚ùå Commit auto-generated files
4. ‚ùå Skip the label attributes in headings/CodeGroups
5. ‚ùå Use inconsistent naming conventions

### Validation Process

Always run the test suite after creating documentation:
```bash
source utils/py/.venv/bin/activate
./utils/run_tests.sh
```

This validates:
- File structure integrity
- Method extraction from labels
- Slug generation
- Internal link consistency
- Compact table data
- Changelog updates

### Common Pitfalls

1. **Missing labels**: Method won't be detected by scripts
2. **Wrong directory structure**: Files not found by glob patterns
3. **Inconsistent naming**: Breaks the method path conversion logic
4. **Manual slug editing**: Gets overwritten by auto-generation
5. **Committing auto-generated files**: Creates merge conflicts

## Example: Complete Process

For a new method `consolidate_utxos`:

1. **Create documentation**: `src/pages/komodo-defi-framework/api/legacy/consolidate_utxos/index.mdx`
2. **Include required elements**:
   ```mdx
   ## consolidate_utxos {{label : 'consolidate_utxos', tag : 'API-v2'}}
   
   <CodeGroup title="Consolidate UTXOs" tag="POST" label="consolidate_utxos" mm2MethodDecorate="true">
   ```
3. **Update sidebar**: Add entry to `src/data/sidebar.json`
4. **Update changelog**: Add feature description
5. **Run tests**: `./utils/run_tests.sh` - this auto-generates:
   - Slugs in `filepathSlugs.json`
   - Method table in `src/pages/komodo-defi-framework/api/index.mdx`
6. **Commit only** (NEVER commit auto-generated files):
   - ‚úÖ Documentation file (`src/pages/komodo-defi-framework/api/legacy/consolidate_utxos/index.mdx`)
   - ‚úÖ Sidebar.json updates (`src/data/sidebar.json`)
   - ‚úÖ Changelog updates (`src/pages/komodo-defi-framework/changelog/index.mdx`)
   - ‚ùå **NEVER COMMIT**: `src/pages/komodo-defi-framework/api/index.mdx` (auto-generated)
   - ‚ùå **NEVER COMMIT**: `filepathSlugs.json` (auto-generated)

### Files That Should NEVER Be Manually Edited or Committed

- `src/pages/komodo-defi-framework/api/index.mdx` - Generated by `gen_api_methods_table.py`
- `filepathSlugs.json` - Generated by build scripts parsing documentation files
- Any file marked with "auto-generated" comments

This approach ensures consistency, reduces conflicts, and maintains the automated build system.
